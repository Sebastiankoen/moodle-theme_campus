define(["jquery","core/log"],function($,log){"use strict";function addShapeGroupImpl(a,b,c){var d=a,e=d.map_data,f=c.isMask;$.each(b.areas(),function(a,b){c.isMask=f||b.nohref&&e.options.noHrefIsMask,d.addShape(b,c)}),c.isMask=f}function hex_to_decimal(a){return Math.max(0,Math.min(parseInt(a,16),255))}function css3color(a,b){return"rgba("+hex_to_decimal(a.substr(0,2))+","+hex_to_decimal(a.substr(2,2))+","+hex_to_decimal(a.substr(4,2))+","+b+")"}function noop(){}function initializeDefaults(a){$.extend(a,{complete:!1,map:null,base_canvas:null,overlay_canvas:null,commands:[],data:[],mapAreas:[],_xref:{},highlightId:-1,currentAreaId:-1,_tooltip_events:[],scaleInfo:null,index:-1,activeAreaEvent:null})}function getOptionImages(a){return[a,a.render_highlight,a.render_select]}function configureAltImages(a){var b=a.options,c=a.images;m.hasCanvas()&&($.each(b.altImages||{},function(a,b){c.add(b,a)}),$.each([b].concat(b.areas),function(a,b){$.each(getOptionImages(b),function(a,b){b&&b.altImage&&(b.altImageId=c.add(b.altImage))})})),a.area_options=u.updateProps({},m.area_defaults,b)}function queueMouseEvent(a,b,c,d){function e(b){a.currentAreaId!==b&&a.highlightId>=0&&d.resolve()}return d=d||u.when.defer(),a.activeAreaEvent&&(window.clearTimeout(a.activeAreaEvent),a.activeAreaEvent=0),0>b?d.reject():c.owner.currentAction||b?a.activeAreaEvent=window.setTimeout(function(){return function(){queueMouseEvent(a,0,c,d)}}(c),b||100):e(c.areaId),d}function mousedown(a){m.hasCanvas()||this.blur(),a.preventDefault()}function mouseover(a,b){var c=a.getAllDataForArea(this),d=c.length?c[0]:null;!d||d.isNotRendered()||d.owner.currentAction||a.currentAreaId!==d.areaId&&(a.highlightId!==d.areaId&&(a.clearEffects(),d.highlight(),a.options.showToolTip&&$.each(c,function(a,b){b.effectiveOptions().toolTip&&b.showToolTip()})),a.currentAreaId=d.areaId,$.isFunction(a.options.onMouseover)&&a.options.onMouseover.call(this,{e:b,options:d.effectiveOptions(),key:d.key,selected:d.isSelected()}))}function mouseout(a,b){var c,d=a.getDataForArea(this),e=a.options;a.currentAreaId<0||!d||(c=a.getDataForArea(b.relatedTarget),c!==d&&(a.currentAreaId=-1,d.area=null,queueMouseEvent(a,e.mouseoutDelay,d).then(a.clearEffects),$.isFunction(e.onMouseout)&&e.onMouseout.call(this,{e:b,options:e,key:d.key,selected:d.isSelected()})))}function clearEffects(a){var b=a.options;a.ensureNoHighlight(),b.toolTipClose&&$.inArray("area-mouseout",b.toolTipClose)>=0&&a.activeToolTip&&a.clearToolTip()}function click(a,b){function c(k){var n,o;if(h=k.isSelectable()&&(k.isDeselectable()||!k.isSelected()),g=h?!k.isSelected():k.isSelected(),f=m.getBoundList(l,k.key),$.isFunction(l.onClick)&&(i=l.onClick.call(j,{e:b,listTarget:f,key:k.key,selected:g}),u.isBool(i))){if(!i)return!1;if(o=$(k.area).attr("href"),"#"!==o)return window.location.href=o,!1}h&&(d=k.toggle()),l.boundList&&l.boundList.length>0&&m.setBoundListProperties(l,f,k.isSelected()),n=k.effectiveOptions(),n.includeKeys&&(e=u.split(n.includeKeys),$.each(e,function(b,d){var e=a.getDataForKey(d.toString());e.options.isMask||c(e)}))}var d,e,f,g,h,i,j=this,k=a.getDataForArea(this),l=a.options;return mousedown.call(this,b),l.clickNavigate&&k.href?void(window.location.href=k.href):void(k&&!k.owner.currentAction&&(l=a.options,c(k)))}function select(a){var b=this,c=b.owner;c.options.singleSelect&&c.clearSelections(),b.isSelected()||(a&&(b.optsCache=$.extend(b.effectiveRenderOptions("select"),a,{altImageId:c.images.add(a.altImage)})),b.drawSelection(),b.selected=!0,b.changeState("select",!0)),c.options.singleSelect&&c.graphics.refreshSelections()}function deselect(a){var b=this;b.selected=!1,b.changeState("select",!1),b.optsCache=null,b.owner.graphics.removeSelections(b.areaId),a||b.owner.removeSelectionFinish()}function toggle(a){var b=this;return b.isSelected()?b.deselect():b.select(a),b.isSelected()}function createToolTip(a,b,c){var d;return b?(d="string"==typeof b?$(b):$(b).clone(),d.append(a)):d=$(a),d.css($.extend(c||{},{display:"block",position:"absolute"})).hide(),$("body").append(d),d.attr("data-opacity",d.css("opacity")).css("opacity",0),d.show()}function showToolTipImpl(a,b){var c={left:b.left+"px",top:b.top+"px"},d=a.attr("data-opacity")||0,e=a.css("z-index");(0===parseInt(e,10)||"auto"===e)&&(c["z-index"]=9999),a.css(c).addClass("mapster_tooltip"),b.fadeDuration&&b.fadeDuration>0?u.fader(a[0],0,d,b.fadeDuration):u.setOpacity(a[0],d)}function bindToolTipClose(a,b,c,d,e,f){var g=c+".mapster-tooltip";return $.inArray(b,a)>=0?(d.unbind(g).bind(g,function(a){(!e||e.call(this,a))&&(d.unbind(".mapster-tooltip"),f&&f.call(this))}),{object:d,event:g}):void 0}function showToolTip(a,b,c,d,e){var f,g={};return e=e||{},b?(f=u.areaCorners(b,c,d,a.outerWidth(!0),a.outerHeight(!0)),g.left=f[0],g.top=f[1]):(g.left=e.left,g.top=e.top),g.left+=e.offsetx||0,g.top+=e.offsety||0,g.css=e.css,g.fadeDuration=e.fadeDuration,showToolTipImpl(a,g),a}function getHtmlFromOptions(a){return a?"string"==typeof a||a.jquery?a:a.content:null}log.debug("Campus ImageMapster AMD jQuery initialised"),function(a){a(function(){function a(){}function b(b){var d=new a;return d.then=function(a){var d;try{return a&&(d=a(b)),h(d===w?b:d)}catch(e){return c(e)}},t(d)}function c(b){var d=new a;return d.then=function(a,d){var e;try{return d?(e=d(b),h(e===w?b:e)):c(b)}catch(f){return c(f)}},t(d)}function d(a){return g(a,function(a){return c(a)})}function e(){function d(a,b,c){return m(a,b,c)}function f(a){o(b(a))}function g(a){o(c(a))}function h(a){n(a)}var i,j,k,l,m,n,o;return k=[],l=[],m=function(a,b,c){var d=e();return k.push(function(c){c.then(a,b).then(d.resolve,d.reject,d.progress)}),c&&l.push(c),d.promise},n=function(a){for(var b,c=0;b=l[c++];)b(a)},o=function(a){var b,c=0;for(m=a.then,o=n=function(){throw new Error("already completed")},l=w;b=k[c++];)b(a);k=[]},i={},j=new a,j.then=i.then=d,i.promise=t(j),i.resolver=t({resolve:i.resolve=f,reject:i.reject=g,progress:i.progress=h}),i}function f(a){return a&&"function"==typeof a.then}function g(a,b,c,d){var e=h(a);return e.then(b,c,d)}function h(b){var c,d;return b instanceof a?c=b:(d=e(),f(b)?(b.then(d.resolve,d.reject,d.progress),c=d.promise):(d.resolve(b),c=d.promise)),c}function i(a,b,c,d,f){return r(2,arguments),g(a,function(a){function h(a){p(a)}function i(a){q(a)}function j(a){r(a)}function k(){p=q=r=s}var l,m,n,o,p,q,r,t,u;if(t=a.length>>>0,l=Math.max(0,Math.min(b,t)),m=[],o=e(),n=g(o,c,d,f),l)for(p=function(a){m.push(a),--l||(k(),o.resolve(m))},q=function(a){k(),o.reject(a)},r=o.progress,u=0;t>u;++u)u in a&&g(a[u],h,i,j);else o.resolve(m);return n})}function j(a,b,c,d){return r(1,arguments),g(a,function(a){return p(a,k,[])}).then(b,c,d)}function k(a,b,c){return a[c]=b,a}function l(a,b,c,d){function e(a){return b?b(a[0]):a[0]}return i(a,1,e,c,d)}function m(a,b){return g(a,function(a){return n(a,b)})}function n(a,b){var c,d,e;for(d=a.length>>>0,c=new Array(d),e=0;d>e;e++)e in a&&(c[e]=g(a[e],b));return p(c,k,c)}function o(a,b,c){var d=v.call(arguments,1);return g(a,function(a){return p.apply(w,[a].concat(d))})}function p(a,b,c){var d,e;return d=a.length,e=[function(a,c,e){return g(a,function(a){return g(c,function(c){return b(a,c,e,d)})})}],arguments.length>2&&e.push(c),u.apply(a,e)}function q(a,b,d){var e=arguments.length>2;return g(a,function(a){return e&&(a=d),b.resolve(a),a},function(a){return b.reject(a),c(a)},b.progress)}function r(a,b){for(var c,d=b.length;d>a;)if(c=b[--d],null!=c&&"function"!=typeof c)throw new Error("callback is not a function")}function s(){}var t,u,v,w;return g.defer=e,g.reject=d,g.isPromise=f,g.all=j,g.some=i,g.any=l,g.map=m,g.reduce=o,g.chain=q,t=Object.freeze||function(a){return a},a.prototype=t({always:function(a,b){return this.then(a,a,b)},otherwise:function(a){return this.then(w,a)}}),v=[].slice,u=[].reduce||function(a){var b,c,d,e,f;if(f=0,b=Object(this),e=b.length>>>0,c=arguments,c.length<=1)for(;;){if(f in b){d=b[f++];break}if(++f>=e)throw new TypeError}else d=c[1];for(;e>f;++f)f in b&&(d=a(d,b[f],f,b));return d},g})}("function"==typeof define?define:function(a){"undefined"!=typeof module?module.exports=a():jQuery.mapster_when=a()}),$.fn.mapster=function(a){var b=$.mapster.impl;return $.isFunction(b[a])?b[a].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof a&&a?void $.error("Method "+a+" does not exist on jQuery.mapster"):b.bind.apply(this,arguments)},$.mapster={version:"1.2.14-beta1",render_defaults:{isSelectable:!0,isDeselectable:!0,fade:!1,fadeDuration:150,fill:!0,fillColor:"000000",fillColorMask:"FFFFFF",fillOpacity:.7,highlight:!0,stroke:!1,strokeColor:"ff0000",strokeOpacity:1,strokeWidth:1,includeKeys:"",altImage:null,altImageId:null,altImages:{}},defaults:{clickNavigate:!1,wrapClass:null,wrapCss:null,onGetList:null,sortList:!1,listenToList:!1,mapKey:"",mapValue:"",singleSelect:!1,listKey:"value",listSelectedAttribute:"selected",listSelectedClass:null,onClick:null,onMouseover:null,onMouseout:null,mouseoutDelay:0,onStateChange:null,boundList:null,onConfigured:null,configTimeout:3e4,noHrefIsMask:!0,scaleMap:!0,safeLoad:!1,areas:[]},shared_defaults:{render_highlight:{fade:!0},render_select:{fade:!1},staticState:null,selected:null},area_defaults:{includeKeys:"",isMask:!1},canvas_style:{position:"absolute",left:0,top:0,padding:0,border:0},hasCanvas:null,isTouch:null,map_cache:[],hooks:{},addHook:function(a,b){this.hooks[a]=(this.hooks[a]||[]).push(b)},callHooks:function(a,b){$.each(this.hooks[a]||[],function(a,c){c.apply(b)})},utils:{when:$.mapster_when,defer:$.mapster_when.defer,subclass:function(a,b){var c=function(){var c=this,d=Array.prototype.slice.call(arguments,0);c.base=a.prototype,c.base.init=function(){a.prototype.constructor.apply(c,d)},b.apply(c,d)};return c.prototype=new a,c.prototype.constructor=c,c},asArray:function(a){return a.constructor===Array?a:this.split(a)},split:function(a,b){var c,d,e=a.split(",");for(c=0;c<e.length;c++)d=$.trim(e[c]),""===d?e.splice(c,1):e[c]=b?b(d):d;return e},updateProps:function(a,b){var c,d=a||{},e=$.isEmptyObject(d)?b:a;return c=[],$.each(e,function(a){c.push(a)}),$.each(Array.prototype.slice.call(arguments,1),function(a,b){$.each(b||{},function(a){if(!c||$.inArray(a,c)>=0){var e=b[a];$.isPlainObject(e)?d[a]=$.extend(d[a]||{},e):e&&e.constructor===Array?d[a]=e.slice(0):"undefined"!=typeof e&&(d[a]=b[a])}})}),d},isElement:function(a){return"object"==typeof HTMLElement?a instanceof HTMLElement:a&&"object"==typeof a&&1===a.nodeType&&"string"==typeof a.nodeName},indexOf:function(a,b){for(var c=0;c<a.length;c++)if(a[c]===b)return c;return-1},indexOfProp:function(a,b,c){var d=a.constructor===Array?-1:null;return $.each(a,function(a,e){return e&&(b?e[b]:e)===c?(d=a,!1):void 0}),d},boolOrDefault:function(a,b){return this.isBool(a)?a:b||!1},isBool:function(a){return"boolean"==typeof a},isUndef:function(a){return"undefined"==typeof a},ifFunction:function(a,b,c){$.isFunction(a)&&a.call(b,c)},size:function(a,b){var c=$.mapster.utils;return{width:b?a.width||a.naturalWidth:c.imgWidth(a,!0),height:b?a.height||a.naturalHeight:c.imgHeight(a,!0),complete:function(){return!!this.height&&!!this.width}}},setOpacity:function(a,b){$.mapster.hasCanvas()?a.style.opacity=b:$(a).each(function(a,c){"undefined"!=typeof c.opacity?c.opacity=b:$(c).css("opacity",b)})},fader:function(){var a={},b=0,c=function(d,e,f,g){var h,i,j=g/15,k=$.mapster.utils;if("number"==typeof d){if(i=a[d],!i)return}else h=k.indexOfProp(a,null,d),h&&delete a[h],a[++b]=i=d,d=b;f=f||1,e=e+f/j>f-.01?f:e+f/j,k.setOpacity(i,e),f>e&&setTimeout(function(){c(d,e,f,g)},15)};return c}()},getBoundList:function(a,b){if(!a.boundList)return null;var c,d,e=$(),f=$.mapster.utils.split(b);return a.boundList.each(function(b,g){for(c=0;c<f.length;c++)d=f[c],$(g).is("["+a.listKey+'="'+d+'"]')&&(e=e.add(g))}),e},setBoundListProperties:function(a,b,c){b.each(function(b,d){a.listSelectedClass&&(c?$(d).addClass(a.listSelectedClass):$(d).removeClass(a.listSelectedClass)),a.listSelectedAttribute&&$(d).attr(a.listSelectedAttribute,c)})},getMapDataIndex:function(a){var b,c;switch(a.tagName&&a.tagName.toLowerCase()){case"area":c=$(a).parent().attr("name"),b=$("img[usemap='#"+c+"']")[0];break;case"img":b=a}return b?this.utils.indexOfProp(this.map_cache,"image",b):-1},getMapData:function(a){var b=this.getMapDataIndex(a.length?a[0]:a);return b>=0?b>=0?this.map_cache[b]:null:void 0},queueCommand:function(a,b,c,d){return a&&(!a.complete||a.currentAction)?(a.commands.push({that:b,command:c,args:d}),!0):!1},unload:function(){this.impl.unload(),this.utils=null,this.impl=null,$.fn.mapster=null,$.mapster=null,$("*").unbind()}};var m=$.mapster,u=m.utils,ap=Array.prototype;$.each(["width","height"],function(a,b){var c=b.substr(0,1).toUpperCase()+b.substr(1);u["img"+c]=function(a,d){return(d?$(a)[b]():0)||a[b]||a["natural"+c]||a["client"+c]||a["offset"+c]}}),m.Method=function(a,b,c,d){var e=this;e.name=d.name,e.output=a,e.input=a,e.first=d.first||!1,e.args=d.args?ap.slice.call(d.args,0):[],e.key=d.key,e.func_map=b,e.func_area=c,e.name=d.name,e.allowAsync=d.allowAsync||!1},m.Method.prototype={constructor:m.Method,go:function(){var a,b,c,d,e,f=this.input,g=[],h=this;for(d=f.length,a=0;d>a;a++)if(b=$.mapster.getMapData(f[a])){if(!h.allowAsync&&m.queueCommand(b,h.input,h.name,h.args)){this.first&&(e="");continue}if(c=b.getData("AREA"===f[a].nodeName?f[a]:this.key),c?$.inArray(c,g)<0&&g.push(c):e=this.func_map.apply(b,h.args),this.first||"undefined"!=typeof e)break}return $(g).each(function(a,b){e=h.func_area.apply(b,h.args)}),"undefined"!=typeof e?e:this.output}},$.mapster.impl=function(){function hasVml(){var a=$("<div />").appendTo("body");a.html('<v:shape id="vml_flag1" adj="1" />');var b=a[0].firstChild;b.style.behavior="url(#default#VML)";var c=b?"object"==typeof b.adj:!0;return a.remove(),c}function namespaces(){return"object"==typeof document.namespaces?document.namespaces:null}function hasCanvas(){var a=namespaces();return a&&a.g_vml_?!1:$("<canvas />")[0].getContext?!0:!1}function merge_areas(a,b){var c,d,e=a.options.areas;b&&$.each(b,function(b,f){f&&f.key&&(d=u.indexOfProp(e,"key",f.key),d>=0?$.extend(e[d],f):e.push(f),c=a.getDataForKey(f.key),c&&$.extend(c.options,f))})}function merge_options(a,b){var c=u.updateProps({},b);delete c.areas,u.updateProps(a.options,c),merge_areas(a,b.areas),u.updateProps(a.area_options,a.options)}var me={},addMap=function(a){return m.map_cache.push(a)-1},removeMap=function(a){m.map_cache.splice(a.index,1);for(var b=m.map_cache.length-1;b>=this.index;b--)m.map_cache[b].index--};return me.get=function(a){var b=m.getMapData(this);if(!b||!b.complete)throw"Can't access data until binding complete.";return new m.Method(this,function(){return this.getSelected()},function(){return this.isSelected()},{name:"get",args:arguments,key:a,first:!0,allowAsync:!0,defaultReturn:""}).go()},me.data=function(a){return new m.Method(this,null,function(){return this},{name:"data",args:arguments,key:a}).go()},me.highlight=function(a){return new m.Method(this,function(){if(a!==!1){var b=this.highlightId;return b>=0?this.data[b].key:null}this.ensureNoHighlight()},function(){this.highlight()},{name:"highlight",args:arguments,key:a,first:!0}).go()},me.keys=function(a,b){function c(a){var c,e=[];b?(c=a.areas(),$.each(c,function(a,b){e=e.concat(b.keys)})):e.push(a.key),$.each(e,function(a,b){$.inArray(b,d)<0&&d.push(b)})}var d=[],e=m.getMapData(this);if(!e||!e.complete)throw"Can't access data until binding complete.";return e&&e.complete?("string"==typeof a?b?c(e.getDataForKey(a)):d=[e.getKeysForGroup(a)]:(b=a,this.each(function(a,b){"AREA"===b.nodeName&&c(e.getDataForArea(b))})),d.join(",")):""},me.select=function(){me.set.call(this,!0)},me.deselect=function(){me.set.call(this,!1)},me.set=function(a,b,c){function d(b){var c=a;if(b){switch(a){case!0:b.select(k);break;case!1:b.deselect(!0);break;default:c=b.toggle(k)}return c}}function e(a){a&&$.inArray(a,j)<0&&(j.push(a),i+=(""===i?"":",")+a.key)}function f(b){$.each(j,function(a,c){var e=d(c);b.options.boundList&&m.setBoundListProperties(b.options,m.getBoundList(b.options,i),e)}),a||b.removeSelectionFinish()}var g,h,i,j,k=c;return this.filter("img,area").each(function(c,d){var l;h=m.getMapData(d),h!==g&&(g&&f(g),j=[],i=""),h&&(l="","IMG"===d.nodeName.toUpperCase()?m.queueCommand(h,$(d),"set",[a,b,k])||(b instanceof Array?b.length&&(l=b.join(",")):l=b,l&&$.each(u.split(l),function(a,b){e(h.getDataForKey(b.toString())),g=h})):(k=b,m.queueCommand(h,$(d),"set",[a,k])||(e(h.getDataForArea(d)),g=h)))}),h&&f(h),this},me.unbind=function(a){return new m.Method(this,function(){this.clearEvents(),this.clearMapData(a),removeMap(this)},null,{name:"unbind",args:arguments}).go()},me.rebind=function(a){return new m.Method(this,function(){var b=this;b.complete=!1,b.configureOptions(a),b.bindImages().then(function(){b.buildDataset(!0),b.complete=!0})},null,{name:"rebind",args:arguments}).go()},me.get_options=function(a,b){var c=u.isBool(a)?a:b;return new m.Method(this,function(){var a=$.extend({},this.options);return c&&(a.render_select=u.updateProps({},m.render_defaults,a,a.render_select),a.render_highlight=u.updateProps({},m.render_defaults,a,a.render_highlight)),a},function(){return c?this.effectiveOptions():this.options},{name:"get_options",args:arguments,first:!0,allowAsync:!0,key:a}).go()},me.set_options=function(a){return new m.Method(this,function(){merge_options(this,a)},null,{name:"set_options",args:arguments}).go()},me.unload=function(){var a;for(a=m.map_cache.length-1;a>=0;a--)m.map_cache[a]&&me.unbind.call($(m.map_cache[a].image));me.graphics=null},me.snapshot=function(){return new m.Method(this,function(){$.each(this.data,function(a,b){b.selected=!1}),this.base_canvas=this.graphics.createVisibleCanvas(this),$(this.image).before(this.base_canvas)},null,{name:"snapshot"}).go()},me.state=function(){var a,b=null;return $(this).each(function(c,d){return"IMG"===d.nodeName?(a=m.getMapData(d),a&&(b=a.state()),!1):void 0}),b},me.bind=function(a){return this.each(function(b,c){var d,e,f,g;if(d=$(c),g=m.getMapData(c)){if(me.unbind.apply(d),!g.complete)return d.bind(),!0;g=null}return f=this.getAttribute("usemap"),e=f&&$('map[name="'+f.substr(1)+'"]'),d.is("img")&&f&&e.size()>0?(d.css("border",0),void(g||(g=new m.MapData(this,a),g.index=addMap(g),g.map=e,g.bindImages().then(function(){g.initialize()})))):!0})},me.init=function(a){var b,c;m.hasCanvas=function(){return u.isBool(m.hasCanvas.value)||(m.hasCanvas.value=u.isBool(a)?a:hasCanvas()),m.hasCanvas.value},m.hasVml=function(){if(!u.isBool(m.hasVml.value)){var a=namespaces();a&&!a.v&&(a.add("v","urn:schemas-microsoft-com:vml"),b=document.createStyleSheet(),c=["shape","rect","oval","circ","fill","stroke","imagedata","group","textbox"],$.each(c,function(a,c){b.addRule("v\\:"+c,"behavior: url(#default#VML); antialias:true")})),m.hasVml.value=hasVml()}return m.hasVml.value},m.isTouch=!!document.documentElement.ontouchstart,u.indexOf=Array.prototype.indexOf||u.indexOf,$.extend(m.defaults,m.render_defaults,m.shared_defaults),$.extend(m.area_defaults,m.render_defaults,m.shared_defaults)},me.test=function(obj){return eval(obj)},me}(),$.mapster.impl.init();var p,m=$.mapster,u=m.utils,canvasMethods,vmlMethods;m.Graphics=function(a){var b=this;b.active=!1,b.canvas=null,b.width=0,b.height=0,b.shapes=[],b.masks=[],b.map_data=a},p=m.Graphics.prototype={constructor:m.Graphics,begin:function(a,b){var c=$(a);this.elementName=b,this.canvas=a,this.width=c.width(),this.height=c.height(),this.shapes=[],this.masks=[],this.active=!0},addShape:function(a,b){var c=b.isMask?this.masks:this.shapes;c.push({mapArea:a,options:b})},createVisibleCanvas:function(a){return $(this.createCanvasFor(a)).addClass("mapster_el").css(m.canvas_style)[0]},addShapeGroup:function(a,b,c){var d,e,f,g=this,h=this.map_data,i=a.effectiveRenderOptions(b);c&&$.extend(i,c),"select"===b?(e="static_"+a.areaId.toString(),f=h.base_canvas):f=h.overlay_canvas,g.begin(f,e),i.includeKeys&&(d=u.split(i.includeKeys),$.each(d,function(a,c){var d=h.getDataForKey(c.toString());addShapeGroupImpl(g,d,d.effectiveRenderOptions(b))})),addShapeGroupImpl(g,a,i),g.render(),i.fade&&u.fader(m.hasCanvas()?f:$(f).find("._fill").not(".mapster_mask"),0,m.hasCanvas()?1:i.fillOpacity,i.fadeDuration)}},canvasMethods={renderShape:function(a,b,c){var d,e=b.coords(null,c);switch(b.shape){case"rect":a.rect(e[0],e[1],e[2]-e[0],e[3]-e[1]);break;case"poly":for(a.moveTo(e[0],e[1]),d=2;d<b.length;d+=2)a.lineTo(e[d],e[d+1]);a.lineTo(e[0],e[1]);break;case"circ":case"circle":a.arc(e[0],e[1],e[2],0,2*Math.PI,!1)}},addAltImage:function(a,b,c,d){a.beginPath(),this.renderShape(a,c),a.closePath(),a.clip(),a.globalAlpha=d.altImageOpacity||d.fillOpacity,a.drawImage(b,0,0,c.owner.scaleInfo.width,c.owner.scaleInfo.height)},render:function(){var a,b,c=this,d=c.map_data,e=c.masks.length,f=c.createCanvasFor(d),g=f.getContext("2d"),h=c.canvas.getContext("2d");return e&&(a=c.createCanvasFor(d),b=a.getContext("2d"),b.clearRect(0,0,a.width,a.height),$.each(c.masks,function(a,d){b.save(),b.beginPath(),c.renderShape(b,d.mapArea),b.closePath(),b.clip(),b.lineWidth=0,b.fillStyle="#000",b.fill(),b.restore()})),$.each(c.shapes,function(a,b){g.save(),b.options.fill&&(b.options.altImageId?c.addAltImage(g,d.images[b.options.altImageId],b.mapArea,b.options):(g.beginPath(),c.renderShape(g,b.mapArea),g.closePath(),g.fillStyle=css3color(b.options.fillColor,b.options.fillOpacity),g.fill())),g.restore()}),$.each(c.shapes.concat(c.masks),function(a,b){var d=1===b.options.strokeWidth?.5:0;b.options.stroke&&(g.save(),g.strokeStyle=css3color(b.options.strokeColor,b.options.strokeOpacity),g.lineWidth=b.options.strokeWidth,g.beginPath(),c.renderShape(g,b.mapArea,d),g.closePath(),g.stroke(),g.restore())}),e?(b.globalCompositeOperation="source-out",b.drawImage(f,0,0),h.drawImage(a,0,0)):h.drawImage(f,0,0),c.active=!1,c.canvas},createCanvasFor:function(a){return $('<canvas width="'+a.scaleInfo.width+'" height="'+a.scaleInfo.height+'"></canvas>')[0]},clearHighlight:function(){var a=this.map_data.overlay_canvas;a.getContext("2d").clearRect(0,0,a.width,a.height)},refreshSelections:function(){var a,b=this.map_data;a=b.base_canvas,b.base_canvas=this.createVisibleCanvas(b),$(b.base_canvas).hide(),$(a).before(b.base_canvas),b.redrawSelections(),$(b.base_canvas).show(),$(a).remove()}},vmlMethods={renderShape:function(a,b,c){var d,e,f,g,h,i,j,k=this,l=a.coords();switch(h=k.elementName?'name="'+k.elementName+'" ':"",i=c?'class="'+c+'" ':"",g='<v:fill color="#'+b.fillColor+'" class="_fill" opacity="'+(b.fill?b.fillOpacity:0)+'" /><v:stroke class="_fill" opacity="'+b.strokeOpacity+'"/>',e=b.stroke?" strokeweight="+b.strokeWidth+' stroked="t" strokecolor="#'+b.strokeColor+'"':' stroked="f"',d=b.fill?' filled="t"':' filled="f"',a.shape){case"rect":j="<v:rect "+i+h+d+e+' style="zoom:1;margin:0;padding:0;display:block;position:absolute;left:'+l[0]+"px;top:"+l[1]+"px;width:"+(l[2]-l[0])+"px;height:"+(l[3]-l[1])+'px;">'+g+"</v:rect>";break;case"poly":j="<v:shape "+i+h+d+e+' coordorigin="0,0" coordsize="'+k.width+","+k.height+'" path="m '+l[0]+","+l[1]+" l "+l.slice(2).join(",")+' x e" style="zoom:1;margin:0;padding:0;display:block;position:absolute;top:0px;left:0px;width:'+k.width+"px;height:"+k.height+'px;">'+g+"</v:shape>";break;case"circ":case"circle":j="<v:oval "+i+h+d+e+' style="zoom:1;margin:0;padding:0;display:block;position:absolute;left:'+(l[0]-l[2])+"px;top:"+(l[1]-l[2])+"px;width:"+2*l[2]+"px;height:"+2*l[2]+'px;">'+g+"</v:oval>"}return f=$(j),$(k.canvas).append(f),f},render:function(){var a,b=this;return $.each(this.shapes,function(a,c){b.renderShape(c.mapArea,c.options)}),this.masks.length&&$.each(this.masks,function(c,d){a=u.updateProps({},d.options,{fillOpacity:1,fillColor:d.options.fillColorMask}),b.renderShape(d.mapArea,a,"mapster_mask")}),this.active=!1,this.canvas},createCanvasFor:function(a){var b=a.scaleInfo.width,c=a.scaleInfo.height;return $('<var width="'+b+'" height="'+c+'" style="zoom:1;overflow:hidden;display:block;width:'+b+"px;height:"+c+'px;"></var>')[0]},clearHighlight:function(){$(this.map_data.overlay_canvas).children().remove()},removeSelections:function(a){a>=0?$(this.map_data.base_canvas).find('[name="static_'+a.toString()+'"]').remove():$(this.map_data.base_canvas).children().remove()}},$.each(["renderShape","addAltImage","render","createCanvasFor","clearHighlight","removeSelections","refreshSelections"],function(a,b){p[b]=function(a){return function(){return p[a]=(m.hasCanvas()?canvasMethods[a]:vmlMethods[a])||noop,p[a].apply(this,arguments)}}(b)});var m=$.mapster,u=m.utils,ap=[];m.MapImages=function(a){this.owner=a,this.clear()},m.MapImages.prototype={constructor:m.MapImages,slice:function(){return ap.slice.apply(this,arguments)},splice:function(){ap.slice.apply(this.status,arguments);var a=ap.slice.apply(this,arguments);return a},complete:function(){return $.inArray(!1,this.status)<0},_add:function(a){var b=ap.push.call(this,a)-1;return this.status[b]=!1,b},indexOf:function(a){return u.indexOf(this,a)},clear:function(){var a=this;a.ids&&a.ids.length>0&&$.each(a.ids,function(b,c){delete a[c]}),a.ids=[],a.length=0,a.status=[],a.splice(0)},add:function(a,b){var c,d,e=this;if(a){if("string"==typeof a){if(d=a,a=e[d],"object"==typeof a)return e.indexOf(a);a=$("<img />").addClass("mapster_el").hide(),c=e._add(a[0]),a.bind("load",function(a){e.imageLoaded.call(e,a)}).bind("error",function(a){e.imageLoadError.call(e,a)}),a.attr("src",d)}else c=e._add($(a)[0]);if(b){if(this[b])throw b+" is already used or is not available as an altImage alias.";e.ids.push(b),e[b]=e[c]}return c}},bind:function(a){var b,c=this,d=c.owner.options.configTimeout/200,e=function(){var a;for(a=c.length;a-- >0&&c.isLoaded(a););c.complete()?c.resolve():d-- >0?c.imgTimeout=window.setTimeout(function(){e.call(c,!0)},50):c.imageLoadError.call(c)};return b=c.deferred=u.defer(),e(),b},resolve:function(){var a=this,b=a.deferred;b&&(a.deferred=null,b.resolve())},imageLoaded:function(a){var b=this,c=b.indexOf(a.target);c>=0&&(b.status[c]=!0,$.inArray(!1,b.status)<0&&b.resolve())},imageLoadError:function(a){clearTimeout(this.imgTimeout),this.triesLeft=0;var b=a?"The image "+a.target.src+" failed to load.":"The images never seemed to finish loading. You may just need to increase the configTimeout if images could take a long time to load.";throw b},isLoaded:function(a){var b,c=this,d=c.status;return d[a]?!0:(b=c[a],"undefined"!=typeof b.complete?d[a]=b.complete:d[a]=!!u.imgWidth(b),d[a])}};var m=$.mapster,u=m.utils;m.MapData=function(a,b){var c=this;c.image=a,c.images=new m.MapImages(c),c.graphics=new m.Graphics(c),c.imgCssText=a.style.cssText||null,initializeDefaults(c),c.configureOptions(b),c.mouseover=function(a){mouseover.call(this,c,a)},c.mouseout=function(a){mouseout.call(this,c,a)},c.click=function(a){click.call(this,c,a)},c.clearEffects=function(a){clearEffects.call(this,c,a)}},m.MapData.prototype={constructor:m.MapData,configureOptions:function(a){this.options=u.updateProps({},m.defaults,a)},bindImages:function(){var a=this,b=a.images;return b.length>2?b.splice(2):0===b.length&&(b.add(a.image),b.add(a.image.src)),configureAltImages(a),a.images.bind()},isActive:function(){return!this.complete||this.currentAction},state:function(){return{complete:this.complete,resizing:"resizing"===this.currentAction,zoomed:this.zoomed,zoomedArea:this.zoomedArea,scaleInfo:this.scaleInfo}},wrapId:function(){return"mapster_wrap_"+this.index},_idFromKey:function(a){return"string"==typeof a&&this._xref.hasOwnProperty(a)?this._xref[a]:-1},getSelected:function(){var a="";return $.each(this.data,function(b,c){c.isSelected()&&(a+=(a?",":"")+this.key)}),a},getAllDataForArea:function(a,b){var c,d,e,f=this,g=$(a).filter("area").attr(f.options.mapKey);if(g)for(e=[],g=u.split(g),c=0;c<(b||g.length);c++)d=f.data[f._idFromKey(g[c])],d.area=a.length?a[0]:a,e.push(d);return e},getDataForArea:function(a){var b=this.getAllDataForArea(a,1);return b?b[0]||null:null},getDataForKey:function(a){return this.data[this._idFromKey(a)]},getKeysForGroup:function(a){var b=this.getDataForKey(a);return b?b.isPrimary?b.key:this.getPrimaryKeysForMapAreas(b.areas()).join(","):""},getPrimaryKeysForMapAreas:function(a){var b=[];return $.each(a,function(a,c){$.inArray(c.keys[0],b)<0&&b.push(c.keys[0])}),b},getData:function(a){return"string"==typeof a?this.getDataForKey(a):a&&a.mapster||u.isElement(a)?this.getDataForArea(a):null},ensureNoHighlight:function(){var a;this.highlightId>=0&&(this.graphics.clearHighlight(),a=this.data[this.highlightId],a.changeState("highlight",!1),this.setHighlightId(-1))},setHighlightId:function(a){this.highlightId=a},clearSelections:function(){$.each(this.data,function(a,b){b.selected&&b.deselect(!0)}),this.removeSelectionFinish()},setAreaOptions:function(a){var b,c,d;for(a=a||[],b=a.length-1;b>=0;b--)c=a[b],c&&(d=this.getDataForKey(c.key),d&&(u.updateProps(d.options,c),u.isBool(c.selected)&&(d.selected=c.selected)))},drawSelections:function(a){var b,c=u.asArray(a);for(b=c.length-1;b>=0;b--)this.data[c[b]].drawSelection()},redrawSelections:function(){$.each(this.data,function(a,b){b.isSelectedOrStatic()&&b.drawSelection()})},initialize:function(){var a,b,c,d,e,f,g,h,i,j,k,l,n=this,o=n.options;if(!n.complete){for(i=$(n.image),e=i.parent().attr("id"),e&&e.length>=12&&"mapster_wrap"===e.substring(0,12)?(d=i.parent(),d.attr("id",n.wrapId())):(d=$('<div id="'+n.wrapId()+'"></div>'),o.wrapClass&&(o.wrapClass===!0?d.addClass(i[0].className):d.addClass(o.wrapClass))),n.wrapper=d,n.scaleInfo=l=u.scaleMap(n.images[0],n.images[1],o.scaleMap),n.base_canvas=b=n.graphics.createVisibleCanvas(n),n.overlay_canvas=c=n.graphics.createVisibleCanvas(n),a=$(n.images[1]).addClass("mapster_el "+n.images[0].className).attr({id:null,usemap:null}),h=u.size(n.images[0]),h.complete&&a.css({width:h.width,height:h.height}),n.buildDataset(),f={display:"block",position:"relative",padding:0,width:l.width,height:l.height},o.wrapCss&&$.extend(f,o.wrapCss),i.parent()[0]!==n.wrapper[0]&&i.before(n.wrapper),d.css(f),$(n.images.slice(2)).hide(),g=1;g<n.images.length;g++)d.append(n.images[g]);d.append(b).append(c).append(i.css(m.canvas_style)),u.setOpacity(n.images[0],0),$(n.images[1]).show(),u.setOpacity(n.images[1],1),o.isSelectable&&o.onGetList&&(k=n.data.slice(0),o.sortList&&(j="desc"===o.sortList?function(a,b){return a===b?0:a>b?-1:1}:function(a,b){return a===b?0:b>a?-1:1},k.sort(function(a,b){return a=a.value,b=b.value,j(a,b)})),n.options.boundList=o.onGetList.call(n.image,k)),n.complete=!0,n.processCommandQueue(),o.onConfigured&&"function"==typeof o.onConfigured&&o.onConfigured.call(i,!0)}},buildDataset:function(a){function b(a,b){var c=new m.AreaData(s,a,b);return c.areaId=s._xref[a]=s.data.push(c)-1,c.areaId}var c,d,e,f,g,h,i,j,k,l,n,o,p,q,r,s=this,t=s.options;for(s._xref={},s.data=[],a||(s.mapAreas=[]),r=!t.mapKey,r&&(t.mapKey="data-mapster-key"),c=m.hasVml()?"area":r?"area[coords]":"area["+t.mapKey+"]",d=$(s.map).find(c).unbind(".mapster"),n=0;n<d.length;n++)if(f=0,h=d[n],g=$(h),h.coords){for(r?(i=String(n),g.attr("data-mapster-key",i)):i=h.getAttribute(t.mapKey),a?(j=s.mapAreas[g.data("mapster")-1],j.configure(i)):(j=new m.MapArea(s,h,i),s.mapAreas.push(j)),l=j.keys,e=l.length-1;e>=0;e--)k=l[e],t.mapValue&&(o=g.attr(t.mapValue)),r?(f=b(s.data.length,o),p=s.data[f],p.key=k=f.toString()):(f=s._xref[k],f>=0?(p=s.data[f],o&&!s.data[f].value&&(p.value=o)):(f=b(k,o),p=s.data[f],p.isPrimary=0===e)),j.areaDataXref.push(f),p.areasXref.push(n);q=g.attr("href"),q&&"#"!==q&&!p.href&&(p.href=q),j.nohref||g.bind("click.mapster",s.click).bind("mouseover.mapster, touchstart.mapster",s.mouseover).bind("mouseout.mapster, touchend.mapster",s.mouseout).bind("mousedown.mapster",s.mousedown),g.data("mapster",n+1)}s.setAreaOptions(t.areas),s.redrawSelections()},processCommandQueue:function(){for(var a,b=this;!b.currentAction&&b.commands.length;)a=b.commands[0],b.commands.splice(0,1),m.impl[a.command].apply(a.that,a.args)},clearEvents:function(){$(this.map).find("area").unbind(".mapster"),$(this.images).unbind(".mapster");
},_clearCanvases:function(a){a||$(this.base_canvas).remove(),$(this.overlay_canvas).remove()},clearMapData:function(a){var b=this;this._clearCanvases(a),$.each(this.data,function(a,b){b.reset()}),this.data=null,a||(this.image.style.cssText=this.imgCssText,$(this.wrapper).before(this.image).remove()),b.images.clear(),this.image=null,u.ifFunction(this.clearTooltip,this)},removeSelectionFinish:function(){var a=this.graphics;a.refreshSelections(),a.clearHighlight()}};var m=$.mapster,u=m.utils;m.AreaData=function(a,b,c){$.extend(this,{owner:a,key:b||"",isPrimary:!0,areaId:-1,href:"",value:c||"",options:{},selected:null,areasXref:[],area:null,optsCache:null})},m.AreaData.prototype={constuctor:m.AreaData,select:select,deselect:deselect,toggle:toggle,areas:function(){var a,b=[];for(a=0;a<this.areasXref.length;a++)b.push(this.owner.mapAreas[this.areasXref[a]]);return b},coords:function(a){var b=[];return $.each(this.areas(),function(c,d){b=b.concat(d.coords(a))}),b},reset:function(){$.each(this.areas(),function(a,b){b.reset()}),this.areasXref=[],this.options=null},isSelectedOrStatic:function(){var a=this.effectiveOptions();return u.isBool(a.staticState)?a.staticState:this.isSelected()},isSelected:function(){return u.isBool(this.selected)?this.selected:u.isBool(this.owner.area_options.selected)?this.owner.area_options.selected:!1},isSelectable:function(){return u.isBool(this.effectiveOptions().staticState)?!1:u.isBool(this.owner.options.staticState)?!1:u.boolOrDefault(this.effectiveOptions().isSelectable,!0)},isDeselectable:function(){return u.isBool(this.effectiveOptions().staticState)?!1:u.isBool(this.owner.options.staticState)?!1:u.boolOrDefault(this.effectiveOptions().isDeselectable,!0)},isNotRendered:function(){var a=$(this.area);return a.attr("nohref")||!a.attr("href")||this.effectiveOptions().isMask},effectiveOptions:function(a){var b=u.updateProps({},this.owner.area_options,this.options,a||{},{id:this.areaId});return b.selected=this.isSelected(),b},effectiveRenderOptions:function(a,b){var c,d=this.optsCache;return d&&"highlight"!==a||(c=this.effectiveOptions(b),d=u.updateProps({},c,c["render_"+a]),"highlight"!==a&&(this.optsCache=d)),$.extend({},d)},changeState:function(a,b){$.isFunction(this.owner.options.onStateChange)&&this.owner.options.onStateChange.call(this.owner.image,{key:this.key,state:a,selected:b})},highlight:function(a){var b=this.owner;this.effectiveOptions().highlight&&b.graphics.addShapeGroup(this,"highlight",a),b.setHighlightId(this.areaId),this.changeState("highlight",!0)},drawSelection:function(){this.owner.graphics.addShapeGroup(this,"select")}},m.MapArea=function(a,b,c){if(a){var d=this;d.owner=a,d.area=b,d.areaDataXref=[],d.originalCoords=[],$.each(u.split(b.coords),function(a,b){d.originalCoords.push(parseFloat(b))}),d.length=d.originalCoords.length,d.shape=b.shape.toLowerCase(),d.nohref=b.nohref||!b.href,d.configure(c)}},m.MapArea.prototype={constructor:m.MapArea,configure:function(a){this.keys=u.split(a)},reset:function(){this.area=null},coords:function(a){return $.map(this.originalCoords,function(b){return a?b:b+a})}};var u=$.mapster.utils;u.areaCorners=function(a,b,c,d,e){var f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,v,w,x,y,z,A=0,B=0,C=[];for(a=a.length?a:[a],c=$(c?c:document.body),f=c.offset(),t=f.left,v=f.top,b&&(f=$(b).offset(),A=f.left,B=f.top),s=0;s<a.length;s++)if(z=a[s],"AREA"===z.nodeName){switch(w=u.split(z.coords,parseInt),z.shape){case"circle":for(p=w[0],q=w[1],x=w[2],C=[],s=0;360>s;s+=20)y=s*Math.PI/180,C.push(p+x*Math.cos(y),q+x*Math.sin(y));break;case"rect":C.push(w[0],w[1],w[2],w[1],w[2],w[3],w[0],w[3]);break;default:C=C.concat(w)}for(s=0;s<C.length;s+=2)C[s]=parseInt(C[s],10)+A,C[s+1]=parseInt(C[s+1],10)+B}else z=$(z),f=z.position(),C.push(f.left,f.top,f.left+z.width(),f.top,f.left+z.width(),f.top+z.height(),f.left,f.top+z.height());for(h=i=l=n=999999,j=k=m=o=-1,s=C.length-2;s>=0;s-=2)p=C[s],q=C[s+1],h>p&&(h=p,o=q),p>j&&(j=p,n=q),i>q&&(i=q,m=p),q>k&&(k=q,l=p);return d&&e&&(g=!1,$.each([[m-d,i-e],[l,i-e],[h-d,o-e],[h-d,n],[j,o-e],[j,n],[m-d,k],[l,k]],function(a,b){return!g&&b[0]>t&&b[1]>v?(r=b,g=!0,!1):void 0}),g||(r=[j,k])),r};var m=$.mapster,u=m.utils,p=m.MapArea.prototype;m.utils.getScaleInfo=function(a,b){var c;return b?(c=a.width/b.width||a.height/b.height,c>.98&&1.02>c&&(c=1)):(c=1,b=a),{scale:1!==c,scalePct:c,realWidth:b.width,realHeight:b.height,width:a.width,height:a.height,ratio:a.width/a.height}},m.utils.scaleMap=function(a,b,c){var d=u.size(a),e=u.size(b,!0);if(!e.complete())throw"Another script, such as an extension, appears to be interfering with image loading. Please let us know about this.";return d.complete()||(d=e),this.getScaleInfo(d,c?e:null)},m.MapData.prototype.resize=function(a,b,c,d){function e(a,b,c){m.hasCanvas()?(a.width=b,a.height=c):($(a).width(b),$(a).height(c))}function f(){p.currentAction="",$.isFunction(d)&&d(),p.processCommandQueue()}function g(){if(e(p.overlay_canvas,a,b),n>=0){var c=p.data[n];c.tempOptions={fade:!1},p.getDataForKey(c.key).highlight(),c.tempOptions=null}e(p.base_canvas,a,b),p.redrawSelections(),f()}function h(){$(p.image).css(k),p.scaleInfo=u.getScaleInfo({width:a,height:b},{width:p.scaleInfo.realWidth,height:p.scaleInfo.realHeight}),$.each(p.data,function(a,b){$.each(b.areas(),function(a,b){b.resize()})})}var i,j,k,l,n,o,p=this;d=d||c,(p.scaleInfo.width!==a||p.scaleInfo.height!==b)&&(n=p.highlightId,a||(o=b/p.scaleInfo.realHeight,a=Math.round(p.scaleInfo.realWidth*o)),b||(o=a/p.scaleInfo.realWidth,b=Math.round(p.scaleInfo.realHeight*o)),k={width:String(a)+"px",height:String(b)+"px"},m.hasCanvas()||$(p.base_canvas).children().remove(),l=$(p.wrapper).find(".mapster_el").add(p.wrapper),c?(j=[],p.currentAction="resizing",l.each(function(a,b){i=u.defer(),j.push(i),$(b).animate(k,{duration:c,complete:i.resolve,easing:"linear"})}),i=u.defer(),j.push(i),u.when.all(j).then(g),h(),i.resolve()):(l.css(k),h(),g()))},m.MapArea=u.subclass(m.MapArea,function(){this.base.init(),this.owner.scaleInfo.scale&&this.resize()}),p.coords=function(a,b){var c,d=[],e=a||this.owner.scaleInfo.scalePct,f=b||0;if(1===e&&0===b)return this.originalCoords;for(c=0;c<this.length;c++)d.push(Math.round(this.originalCoords[c]*e)+f);return d},p.resize=function(){this.area.coords=this.coords().join(",")},p.reset=function(){this.area.coords=this.coords(1).join(",")},m.impl.resize=function(a,b,c,d){if(!a&&!b)return!1;var e=new m.Method(this,function(){this.resize(a,b,c,d)},null,{name:"resize",args:arguments}).go();return e};var m=$.mapster,u=m.utils;return $.extend(m.defaults,{toolTipContainer:'<div style="border: 2px solid black; background: #EEEEEE; width:160px; padding:4px; margin: 4px; -moz-box-shadow: 3px 3px 5px #535353; -webkit-box-shadow: 3px 3px 5px #535353; box-shadow: 3px 3px 5px #535353; -moz-border-radius: 6px 6px 6px 6px; -webkit-border-radius: 6px; border-radius: 6px 6px 6px 6px; opacity: 0.9;"></div>',showToolTip:!1,toolTipFade:!0,toolTipClose:["area-mouseout","image-mouseout"],onShowToolTip:null,onHideToolTip:null}),$.extend(m.area_defaults,{toolTip:null,toolTipClose:null}),m.MapData.prototype.clearToolTip=function(){this.activeToolTip&&(this.activeToolTip.stop().remove(),this.activeToolTip=null,this.activeToolTipID=null,u.ifFunction(this.options.onHideToolTip,this))},m.AreaData.prototype.showToolTip=function(a,b){var c,d,e,f,g,h={},i=this,j=i.owner,k=i.effectiveOptions();return b=b?$.extend({},b):{},a=a||k.toolTip,d=b.closeEvents||k.toolTipClose||j.options.toolTipClose||"tooltip-click",g="undefined"!=typeof b.template?b.template:j.options.toolTipContainer,b.closeEvents="string"==typeof d?d=u.split(d):d,b.fadeDuration=b.fadeDuration||(j.options.toolTipFade?j.options.fadeDuration||k.fadeDuration:0),e=i.area?i.area:$.map(i.areas(),function(a){return a.area}),j.activeToolTipID!==i.areaId?(j.clearToolTip(),j.activeToolTip=c=createToolTip(a,g,b.css),j.activeToolTipID=i.areaId,f=function(){j.clearToolTip()},bindToolTipClose(d,"area-click","click",$(j.map),null,f),bindToolTipClose(d,"tooltip-click","click",c,null,f),bindToolTipClose(d,"image-mouseout","mouseout",$(j.image),function(a){return a.relatedTarget&&"AREA"!==a.relatedTarget.nodeName&&a.relatedTarget!==i.area},f),showToolTip(c,e,j.image,b.container,g,b),u.ifFunction(j.options.onShowToolTip,i.area,{toolTip:c,options:h,areaOptions:k,key:i.key,selected:i.isSelected()}),c):void 0},m.impl.tooltip=function(a,b){return new m.Method(this,function(){var c,d,e=this;if(a){if(d=$(a),e.activeToolTipID===d[0])return;e.clearToolTip(),e.activeToolTip=c=createToolTip(getHtmlFromOptions(b),b.template||e.options.toolTipContainer,b.css),e.activeToolTipID=d[0],bindToolTipClose(["tooltip-click"],"tooltip-click","click",c,null,function(){e.clearToolTip()}),e.activeToolTip=c=showToolTip(c,d,e.image,b.container,b)}else e.clearToolTip()},function(){$.isPlainObject(a)&&!b&&(b=a),this.showToolTip(getHtmlFromOptions(b),b)},{name:"tooltip",args:arguments,key:a}).go()},{init:function(){log.debug("Campus ImageMapster AMD init initialised"),$(document).ready(function(){function a(a,b){var d=$("img"),e=d.width(),f=d.height(),g=0,h=0;e/a>f/b?g=a:h=b,d.mapster("resize",g,h,c)}function b(){var b=$(window).width(),c=$(window).height(),e=!1;e||(e=!0,window.setTimeout(function(){var d=$(window).width(),f=$(window).height();d===b&&f===c&&a(d,f),e=!1},d))}var c=100,d=100;$("img[usemap]").mapster({mapKey:"state"}),$(window).bind("resize",b)})}}});